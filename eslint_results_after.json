[{"filePath":"/home/runner/work/llm-as-a-judge-sample/llm-as-a-judge-sample/bin/llm-as-a-judge-sample.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/runner/work/llm-as-a-judge-sample/llm-as-a-judge-sample/eslint.config.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/runner/work/llm-as-a-judge-sample/llm-as-a-judge-sample/lambda/orderProcessor.ts","messages":[{"ruleId":"sonarjs/cognitive-complexity","severity":1,"message":"Refactor this function to reduce its Cognitive Complexity from 27 to the 15 allowed.","line":29,"column":73,"messageId":"refactorFunction","endLine":29,"endColumn":75},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'processRefund' is defined but never used.","line":93,"column":16,"messageId":"unusedVar","endLine":93,"endColumn":29}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// 注文処理Lambda\n\nconst ORDERS_TABLE = 'orders-table-prod';\nconst HISTORY_TABLE = 'order-history-prod';\nconst SNS_TOPIC = 'arn:aws:sns:ap-northeast-1:123456789012:order-notifications';\n\n// 最小限の型定義（外部依存を増やさない）\ntype ApiEvent = { body: string };\ntype OrderItem = { price: number; quantity: number };\ntype OrderRequest = { orderId?: string; userId?: string; items?: OrderItem[] };\ntype LambdaResponse = { statusCode: number; body: string };\n\ninterface DbPutInput { TableName: string; Item: Record<string, unknown> }\ninterface DbGetInput { TableName: string; Key: { orderId: string } }\ninterface DbClient {\n    put: (p: DbPutInput) => Promise<DbPutInput>;\n    get: (p: DbGetInput) => Promise<Record<string, unknown>>;\n}\n\ninterface SnsPublishInput { TopicArn: string; Message: string; Subject?: string }\ninterface SnsClient { publish: (p: SnsPublishInput) => Promise<SnsPublishInput> }\n\nconst db: DbClient = {\n    put: async (p) => p,\n    get: async (p) => ({ ...p }),\n};\nconst snsClient: SnsClient = { publish: async (p) => p };\n\nexport const handler = async (event: ApiEvent): Promise<LambdaResponse> => {\n    const body = JSON.parse(event.body);\n\n    const orderId = (body as OrderRequest).orderId;\n    const userId = (body as OrderRequest).userId;\n    const items = (body as OrderRequest).items;\n    let discount = 0;\n\n    if (items) {\n        if (items.length > 0) {\n            if (userId) {\n                if (orderId) {\n                    let total = 0;\n                    for (let i = 0; i < items.length; i++) {\n                        if (items[i].price && items[i].quantity) {\n                            total += items[i].price * items[i].quantity;\n                        }\n                    }\n\n                    if (total > 1000) {\n                        discount = total * 0.1;\n                    }\n                    const finalTotal = total - discount;\n\n                    db.put({\n                        TableName: ORDERS_TABLE,\n                        Item: {\n                            orderId,\n                            userId,\n                            total: finalTotal,\n                            status: 'PENDING',\n                            createdAt: new Date().toISOString(),\n                        },\n                    });\n\n                    db.put({\n                        TableName: HISTORY_TABLE,\n                        Item: {\n                            orderId,\n                            userId,\n                            total: finalTotal,\n                            status: 'PENDING',\n                            createdAt: new Date().toISOString(),\n                        },\n                    });\n\n                    snsClient.publish({\n                        TopicArn: SNS_TOPIC,\n                        Message: '注文受付: ' + orderId + ' 合計: ' + finalTotal,\n                        Subject: 'New Order',\n                    });\n\n                    return {\n                        statusCode: 200,\n                        body: JSON.stringify({ ok: true }),\n                    };\n                }\n            }\n        }\n    }\n\n    return { statusCode: 400, body: JSON.stringify({ error: 'Invalid' }) };\n};\n\nasync function processRefund(orderId: string, userId: string, amount: number) {\n    if (orderId) {\n        if (userId) {\n            if (amount > 0) {\n                const existing = await db.get({\n                    TableName: ORDERS_TABLE,\n                    Key: { orderId },\n                });\n                if (existing) {\n                    const status = (existing as { status?: string }).status;\n                    if (status === 'COMPLETED') {\n                        await db.put({\n                            TableName: ORDERS_TABLE,\n                            Item: {\n                                ...existing,\n                                status: 'REFUNDED',\n                                refundAmount: amount,\n                                updatedAt: new Date().toISOString(),\n                            },\n                        });\n                        await db.put({\n                            TableName: HISTORY_TABLE,\n                            Item: {\n                                ...existing,\n                                status: 'REFUNDED',\n                                refundAmount: amount,\n                                updatedAt: new Date().toISOString(),\n                            },\n                        });\n\n                        await snsClient.publish({\n                            TopicArn: SNS_TOPIC,\n                            Message: 'Refund processed: ' + orderId + ' amount: ' + amount,\n                        });\n\n                        return { success: true };\n                    }\n                }\n            }\n        }\n    }\n    return { success: false };\n}\n","usedDeprecatedRules":[]},{"filePath":"/home/runner/work/llm-as-a-judge-sample/llm-as-a-judge-sample/lib/llm-as-a-judge-sample-stack.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ordersTable' is assigned a value but never used.","line":11,"column":15,"messageId":"unusedVar","endLine":11,"endColumn":26}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as cdk from 'aws-cdk-lib/core';\nimport * as lambda from 'aws-cdk-lib/aws-lambda';\nimport * as iam from 'aws-cdk-lib/aws-iam';\nimport * as dynamodb from 'aws-cdk-lib/aws-dynamodb';\nimport { Construct } from 'constructs';\n\nexport class LlmAsAJudgeSampleStack extends cdk.Stack {\n    constructor(scope: Construct, id: string, props?: cdk.StackProps) {\n        super(scope, id, props);\n\n        const ordersTable = new dynamodb.Table(this, 'OrdersTable', {\n            tableName: 'orders-table-prod',\n            partitionKey: {\n                name: 'orderId',\n                type: dynamodb.AttributeType.STRING,\n            },\n        });\n\n        const orderProcessor = new lambda.Function(this, 'OrderProcessor', {\n            runtime: lambda.Runtime.NODEJS_22_X,\n            code: lambda.Code.fromAsset('lambda'),\n            handler: 'orderProcessor.handler',\n            timeout: cdk.Duration.seconds(300),\n            environment: {\n                ORDERS_TABLE: 'orders-table-prod',\n                HISTORY_TABLE: 'order-history-prod',\n                SNS_TOPIC:\n                    'arn:aws:sns:ap-northeast-1:123456789012:order-notifications',\n                ENV: 'prod',\n            },\n        });\n\n        orderProcessor.addToRolePolicy(\n            new iam.PolicyStatement({\n                effect: iam.Effect.ALLOW,\n                actions: ['*'],\n                resources: ['*'],\n            }),\n        );\n    }\n}\n","usedDeprecatedRules":[]},{"filePath":"/home/runner/work/llm-as-a-judge-sample/llm-as-a-judge-sample/test/llm-as-a-judge-sample.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/runner/work/llm-as-a-judge-sample/llm-as-a-judge-sample/test/orderProcessor.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]
